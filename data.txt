# GHGダッシュボード用スタースキーマ＆データセット

## 📊 スタースキーマ設計

```
                    ┌─────────────────┐
                    │   時間ディメンション  │
                    │   (dim_time)     │
                    │                 │
                    │ time_id (PK)    │
                    │ year           │
                    │ month          │
                    │ quarter        │
                    │ fiscal_year    │
                    └─────────────────┘
                             │
                             │
    ┌─────────────────┐      │      ┌─────────────────┐
    │  拠点ディメンション  │      │      │ エネルギーディメンション│
    │  (dim_location)  │      │      │ (dim_energy)    │
    │                 │      │      │                 │
    │ location_id (PK)│      │      │ energy_id (PK)  │
    │ location_name   │      │      │ energy_type     │
    │ location_type   │      │      │ energy_unit     │
    │ address         │      │      │ energy_category │
    │ floor_area      │      │      │ emission_factor │
    └─────────────────┘      │      └─────────────────┘
             │               │               │
             │               │               │
             │    ┌─────────────────────────┐│
             └────│     事実テーブル        ││
                  │   (fact_ghg_emissions) ││
                  │                        ││
                  │ time_id (FK)           ││
                  │ location_id (FK)       │┘
                  │ energy_id (FK)         │
                  │ scope_id (FK)          │
                  │ usage_amount           │
                  │ co2_emissions_t        │
                  │ benchmark_value        │
                  │ target_value           │
                  └─────────────────────────┘
                             │
                             │
                    ┌─────────────────┐
                    │ Scopeディメンション│
                    │ (dim_scope)     │
                    │                 │
                    │ scope_id (PK)   │
                    │ scope_name      │
                    │ scope_category  │
                    │ description     │
                    └─────────────────┘
```

## 📋 データセット

### 1. 時間ディメンション (dim_time.csv)

```csv
time_id,year,month,quarter,fiscal_year,year_month
202401,2024,1,Q4,2023,2024-01
202402,2024,2,Q4,2023,2024-02
202403,2024,3,Q4,2023,2024-03
202404,2024,4,Q1,2024,2024-04
202405,2024,5,Q1,2024,2024-05
202406,2024,6,Q1,2024,2024-06
202407,2024,7,Q2,2024,2024-07
202408,2024,8,Q2,2024,2024-08
202409,2024,9,Q2,2024,2024-09
202410,2024,10,Q3,2024,2024-10
202411,2024,11,Q3,2024,2024-11
202412,2024,12,Q3,2024,2024-12
```

### 2. 拠点ディメンション (dim_location.csv)

```csv
location_id,location_name,location_type,address,floor_area_m2,employee_count
LOC001,大阪本社,本社事務所,大阪府大阪市淀川区田川2-1-11,12000,680
LOC002,琵琶湖工場,製造工場,滋賀県甲賀市水口町宇川1110,28000,1200
LOC003,神戸工場,製造工場,兵庫県神戸市西区高塚台5-5-1,22000,850
LOC004,つくば研究所,研究開発,茨城県つくば市,8500,320
LOC005,東京営業所,営業所,東京都港区,1200,85
```

### 3. エネルギーディメンション (dim_energy.csv)

```csv
energy_id,energy_type,energy_unit,energy_category,emission_factor,factor_unit,data_source
ENG001,電力,kWh,電気エネルギー,0.000453,tCO2/kWh,環境省2024
ENG002,都市ガス,m3,燃料,2.23,tCO2/千m3,環境省2024
ENG003,重油A,L,燃料,2.71,tCO2/kL,環境省2024
ENG004,軽油,L,燃料,2.58,tCO2/kL,環境省2024
ENG005,ガソリン,L,燃料,2.32,tCO2/kL,環境省2024
ENG006,SF6ガス,kg,工業ガス,22800,tCO2/t,環境省2024
ENG007,絶縁油,L,工業用油,2.1,tCO2/kL,推定値
```

### 4. Scopeディメンション (dim_scope.csv)

```csv
scope_id,scope_name,scope_category,description
SC001,Scope1,直接排出,自社での燃料燃焼による直接排出
SC002,Scope2,間接排出,購入電力・熱による間接排出
SC003,Scope3-Cat1,間接排出,購入した製品・サービス
SC004,Scope3-Cat2,間接排出,資本財
SC005,Scope3-Cat4,間接排出,輸送・配送(上流)
SC006,Scope3-Cat5,間接排出,事業から出る廃棄物
SC007,Scope3-Cat6,間接排出,出張
SC008,Scope3-Cat7,間接排出,従業員の通勤
```

### 5. 事実テーブル (fact_ghg_emissions.csv)

```csv
time_id,location_id,energy_id,scope_id,usage_amount,co2_emissions_t,benchmark_value_t,target_value_t,data_quality
202401,LOC001,ENG001,SC002,45000,20.4,22.1,19.5,実測
202401,LOC002,ENG001,SC002,165000,74.7,79.8,71.2,実測
202401,LOC002,ENG002,SC001,11000,24.5,26.2,23.0,実測
202401,LOC002,ENG003,SC001,7500,20.3,21.8,19.1,実測
202401,LOC002,ENG006,SC001,0.1,2.3,2.5,2.1,実測
202401,LOC003,ENG001,SC002,125000,56.6,62.1,54.0,実測
202401,LOC003,ENG002,SC001,8200,18.3,19.8,17.1,実測
202401,LOC004,ENG001,SC002,25000,11.3,12.5,10.8,実測
202401,LOC005,ENG001,SC002,8500,3.9,4.2,3.5,実測
202402,LOC001,ENG001,SC002,42000,19.0,22.1,19.5,実測
202402,LOC002,ENG001,SC002,158000,71.6,79.8,71.2,実測
202402,LOC002,ENG002,SC001,10500,23.4,26.2,23.0,実測
202402,LOC002,ENG003,SC001,7200,19.5,21.8,19.1,実測
202402,LOC002,ENG006,SC001,0.09,2.1,2.5,2.1,実測
202402,LOC003,ENG001,SC002,119000,53.9,62.1,54.0,実測
202402,LOC003,ENG002,SC001,7800,17.4,19.8,17.1,実測
202402,LOC004,ENG001,SC002,23500,10.6,12.5,10.8,実測
202402,LOC005,ENG001,SC002,8100,3.7,4.2,3.5,実測
202403,LOC001,ENG001,SC002,43500,19.7,22.1,19.5,実測
202403,LOC002,ENG001,SC002,162000,73.4,79.8,71.2,実測
202403,LOC002,ENG002,SC001,10800,24.1,26.2,23.0,実測
202403,LOC002,ENG003,SC001,7400,20.1,21.8,19.1,実測
202403,LOC002,ENG006,SC001,0.095,2.2,2.5,2.1,実測
202403,LOC003,ENG001,SC002,122000,55.3,62.1,54.0,実測
202403,LOC003,ENG002,SC001,8000,17.8,19.8,17.1,実測
202403,LOC004,ENG001,SC002,24200,11.0,12.5,10.8,実測
202403,LOC005,ENG001,SC002,8300,3.8,4.2,3.5,実測
```

### 6. Scope3推定データ (fact_scope3_emissions.csv)

```csv
time_id,location_id,scope_id,category_name,co2_emissions_t,calculation_method,data_source
202401,LOC002,SC003,購入製品・サービス,420.5,調達金額×排出原単位,調達システム
202401,LOC002,SC004,資本財,85.2,固定資産取得額×排出原単位,会計システム
202401,LOC002,SC005,輸送・配送(上流),58.9,物流費×排出原単位,物流実績
202401,LOC002,SC006,廃棄物,32.1,廃棄物量×処理別排出原単位,廃棄物実績
202401,LOC002,SC007,出張,12.3,交通費×排出原単位,経費システム
202401,LOC002,SC008,通勤,35.8,従業員数×通勤距離×排出原単位,通勤実態調査
202402,LOC002,SC003,購入製品・サービス,398.2,調達金額×排出原単位,調達システム
202402,LOC002,SC004,資本財,92.1,固定資産取得額×排出原単位,会計システム
202402,LOC002,SC005,輸送・配送(上流),55.3,物流費×排出原単位,物流実績
202402,LOC002,SC006,廃棄物,29.8,廃棄物量×処理別排出原単位,廃棄物実績
202402,LOC002,SC007,出張,8.9,交通費×排出原単位,経費システム
202402,LOC002,SC008,通勤,35.8,従業員数×通勤距離×排出原単位,通勤実態調査
```

### 7. 削減目標管理テーブル (target_management.csv)

```csv
target_id,location_id,target_year,target_month,baseline_year,baseline_emissions_t,target_emissions_t,reduction_rate,status
TGT001,LOC002,2024,12,2019,1850.5,1480.4,20.0,進行中
TGT002,LOC003,2024,12,2019,1420.8,1136.6,20.0,進行中
TGT003,LOC001,2024,12,2019,285.2,228.2,20.0,進行中
TGT004,LOC004,2024,12,2019,158.5,126.8,20.0,進行中
TGT005,LOC005,2024,12,2019,52.3,41.8,20.0,進行中
```

## 🔧 データセット利用方法

### SQLクエリ例

```sql
-- 月次排出量集計
SELECT 
    t.year_month,
    l.location_name,
    s.scope_name,
    SUM(f.co2_emissions_t) as total_emissions
FROM fact_ghg_emissions f
JOIN dim_time t ON f.time_id = t.time_id
JOIN dim_location l ON f.location_id = l.location_id
JOIN dim_scope s ON f.scope_id = s.scope_id
WHERE t.year = 2024
GROUP BY t.year_month, l.location_name, s.scope_name
ORDER BY t.year_month, l.location_name;

-- ベンチマーク比較
SELECT 
    l.location_name,
    e.energy_type,
    SUM(f.co2_emissions_t) as actual_emissions,
    SUM(f.benchmark_value_t) as benchmark_emissions,
    ROUND((SUM(f.co2_emissions_t) / SUM(f.benchmark_value_t) - 1) * 100, 1) as variance_pct
FROM fact_ghg_emissions f
JOIN dim_location l ON f.location_id = l.location_id
JOIN dim_energy e ON f.energy_id = e.energy_id
WHERE f.time_id BETWEEN 202401 AND 202403
GROUP BY l.location_name, e.energy_type;
```

### Pythonでの読み込み例

```python
import pandas as pd

# データセット読み込み
dim_time = pd.read_csv('dim_time.csv')
dim_location = pd.read_csv('dim_location.csv')
dim_energy = pd.read_csv('dim_energy.csv')
dim_scope = pd.read_csv('dim_scope.csv')
fact_ghg = pd.read_csv('fact_ghg_emissions.csv')

# 結合してダッシュボード用データ作成
dashboard_data = fact_ghg.merge(dim_time, on='time_id') \
                        .merge(dim_location, on='location_id') \
                        .merge(dim_energy, on='energy_id') \
                        .merge(dim_scope, on='scope_id')
```

## ✅ データ品質チェックポイント

1. **データ整合性**: 外部キー制約の確認
2. **欠損値**: 必須項目の欠損チェック
3. **範囲チェック**: CO2排出量の妥当性確認
4. **時系列一貫性**: 月次データの連続性
5. **ベンチマーク妥当性**: 業界平均との乖離度合い

このスタースキーマとデータセットにより、効率的なGHGダッシュボードの構築が可能になります。
